<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado-participantes</title>
    <link rel="stylesheet" href="../../assets/css/estilo.css">
</head>

<body>
    <header id="header"></header>
    <main id="laterales-inscripcion">
        <div id="opa-hijo">
            <div id>
                <div id="container-zona-alta-inscripciones">
                    <div id="zona-alta-inscripciones">
                        <div id="container-titulo-prueba-inscripcion">
                            <div id="titulo-prueba-inscripcion">
                                <h2 id="nombre-prueba-inscripcion">XVII HOTIZON TRIATLON SEVILLLA (DISTANCIA OLIMPICA)
                                </h2>
                            </div>
                        </div>
                        <div id="lista-superior">
                            <ul id="lista-completa">
                                <a href="../../paginas/eventos.html">
                                    <li class="numero">Inicio</li>
                                </a>
                                <li class="numero">Inscripciones
                                    <ul id="lista-desplegable-inscripcion">
                                        <a href="../../paginas/inscripcion/listado-participantes.html">
                                            <li class="enlaces-inscripciones">Listado de participantes</li>
                                        </a>
                                        <a href="">
                                            <a href="../../paginas/inscripcion/formulario-inscripcion.html">
                                                <li class="enlaces-inscripciones">Inscríbete</li>
                                            </a>
                                        </a>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="container-lista-participantes-completa">
                    <div id="lista-participantes-completa">
                        <div id="titulo-lista-participantes">
                            <h3>Listado de participantes</h3>
                        </div>
                        <div id="container-filtros-listado-participantes">
                            <div id="filtros-listado-participantes">
                                <section id="buscador-palabras">
                                    <!-- Buscador por palabras -->
                                    <input type="text" id="buscador" placeholder="Buscar...">
                                    <button id="buscar">Buscar</button>
                                </section>
                                <section id="filtros-participantes">
                                    <!-- Filtros distintos -->
                                    <label for="filtro-categoria"></label>
                                    <select class="filtros">
                                        <option value="todos">Ver todos</option>
                                        <option value="Mujeres">Mujeres</option>
                                        <option value="Hombres">Hombres</option>
                                    </select>
                                    <label for="filtro-edad"></label>
                                    <select class="filtros">
                                        <option value="Agrupar">Agrupar por</option>
                                        <option value="Categoria">Categoría</option>
                                        <option value="Club">Club</option>
                                    </select>
                                </section>
                                <section>
                                    <!-- Texto que muestra cuántos registros hay -->
                                    <p id="num-registros">Registros encontrados: XX</p>
                                </section>
                            </div>
                        </div>
                        <div id="container-tabla-lista-participantes">
                            <!-- Aquí se insertará la tabla de participantes generada por PHP -->
                        </div>
                        <nav id="navegacion-paginas-listado-participantes">
                            <ul id="pager">
                                <!-- Paginación generada por JavaScript -->
                            </ul>
                        </nav>

                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div id="footer"></div>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            const headerContainer = document.getElementById('header');
            const footerContainer = document.getElementById('footer');
            const tablaContainer = document.getElementById('container-tabla-lista-participantes');
            const pagerContainer = document.getElementById('pager');

            // Obtener la ruta relativa al directorio actual
            const currentPagePath = window.location.pathname;
            const currentPageDirectory = currentPagePath.substring(0, currentPagePath.lastIndexOf('/'));

            // Cargar el encabezado
            fetch(currentPageDirectory + '/../header-inscripciones.html')
                .then(response => response.text())
                .then(data => {
                    headerContainer.innerHTML = data;
                });

            // Cargar el pie de página
            fetch(currentPageDirectory + '/../footer.html')
                .then(response => response.text())
                .then(data => {
                    footerContainer.innerHTML = data;
                });

            // Cargar la tabla de participantes generada por PHP con la página actual
            fetch('../../assets/php/procesar-formulario.php?pagina=1') // Modifica la página según sea necesario
                .then(response => response.text())
                .then(data => {
                    tablaContainer.innerHTML = data;
                });

            // Obtener el número total de registros y actualizar el texto
            fetch('../../assets/php/contar-registros.php')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('num-registros').textContent = "Registros encontrados: " + data;
                    updatePager(parseInt(data)); // Actualiza el paginador con el número total de registros
                });
        });

        function updatePager(totalRecords) {
            var maxPerPage = 5; // Número máximo de registros por página
            var totalPages = Math.ceil(totalRecords / maxPerPage);
            var pagerHTML = '';

            // Construye la paginación
            for (var i = 1; i <= totalPages; i++) {
                pagerHTML += '<li><a href="#" onclick="loadPage(' + i + ')">' + i + '</a></li>';
            }
            document.getElementById('pager').innerHTML = pagerHTML;
        }

        // Función para cargar una página específica
        function loadPage(pageNumber) {
            fetch('../../assets/php/procesar-formulario.php?pagina=' + pageNumber)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('container-tabla-lista-participantes').innerHTML = data;
                });
        }

        // Función para buscar registros
        document.addEventListener('DOMContentLoaded', function () {
            const btnBuscar = document.getElementById('buscar');
            const inputBuscador = document.getElementById('buscador');
            const tablaContainer = document.getElementById('container-tabla-lista-participantes');

            btnBuscar.addEventListener('click', function () {
                const valorBusqueda = inputBuscador.value.trim();

                fetch('../../assets/php/buscar-registros.php?palabra=' + encodeURIComponent(valorBusqueda))
                    .then(response => response.text())
                    .then(data => {
                        tablaContainer.innerHTML = data;
                        updatePagination(parseInt(data)); // Actualiza la paginación con el número total de registros
                    })
                    .catch(error => console.error('Error al realizar la búsqueda:', error));
            });
        });

        // Función para actualizar la paginación según la cantidad de resultados de la búsqueda
        function updatePagination(totalRecords) {
            var maxPerPage = 5; // Número máximo de registros por página
            var totalPages = Math.ceil(totalRecords / maxPerPage);
            var pagerHTML = '';

            // Ajusta el número de páginas a mostrar en la paginación
            var maxPagesToShow = 5; // Cambia este valor según tu preferencia
            var startPage = 1;
            var endPage = totalPages;
            var currentPage = 1;

            // Verifica si hay más páginas de las que se deben mostrar
            if (totalPages > maxPagesToShow) {
                var halfMaxPages = Math.floor(maxPagesToShow / 2);
                currentPage = Math.min(Math.max(1, currentPage), totalPages); // Asegura que la página actual esté dentro del rango

                // Calcula el inicio y el final de las páginas a mostrar
                startPage = Math.max(currentPage - halfMaxPages, 1);
                endPage = Math.min(currentPage + halfMaxPages, totalPages);

                // Ajusta el inicio o el final si es necesario para mostrar el número correcto de páginas
                if (endPage - startPage + 1 < maxPagesToShow) {
                    if (currentPage < halfMaxPages + 1) {
                        endPage = Math.min(startPage + maxPagesToShow - 1, totalPages);
                    } else {
                        startPage = Math.max(endPage - maxPagesToShow + 1, 1);
                    }
                }
            }

            // Construye la paginación
            for (var i = startPage; i <= endPage; i++) {
                pagerHTML += '<li><a href="#" onclick="loadPage(' + i + ')">' + i + '</a></li>';
            }
            document.getElementById('pager').innerHTML = pagerHTML;
        }

    </script>
    <script src="../../assets/js/script.js"></script>
</body>

</html>
